container_commands:
  01_install_all_dependencies:
    command: "npm ci"
    cwd: "/var/app/staging"
    leader_only: true
  02_build_app:
    command: "npm run build"
    cwd: "/var/app/staging" 
    leader_only: true
  03_remove_dev_dependencies:
    command: "npm prune --production"
    cwd: "/var/app/staging"
    leader_only: true
  04_fix_permissions:
    command: "chown -R webapp:webapp .next"
    cwd: "/var/app/staging"
    leader_only: true
  05_verify_build:
    command: "ls -la .next/"
    cwd: "/var/app/staging"
    leader_only: true
  06_restart_nginx:
    command: "service nginx restart"
    leader_only: true