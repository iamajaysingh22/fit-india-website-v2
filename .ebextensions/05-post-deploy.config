files:
  "/opt/elasticbeanstalk/hooks/appdeploy/post/01_verify_deployment.sh":
    mode: "000755"
    owner: root
    group: root
    content: |
      #!/bin/bash
      cd /var/app/current
      
      echo "Verifying deployment..."
      
      # Check if .next directory exists
      if [ ! -d ".next" ]; then
        echo "ERROR: .next directory not found!"
        exit 1
      fi
      
      # Check if build-id exists
      if [ ! -f ".next/BUILD_ID" ]; then
        echo "ERROR: BUILD_ID not found!"
        exit 1
      fi
      
      # Check if the app is running
      sleep 5
      if ! pgrep -f "node.*next" > /dev/null; then
        echo "ERROR: Next.js process not running!"
        exit 1
      fi
      
      echo "Deployment verification completed successfully"
      echo "Build ID: $(cat .next/BUILD_ID)"
      echo "Node.js processes:"
      pgrep -f "node.*next" -l
      
  "/opt/elasticbeanstalk/hooks/appdeploy/post/02_fix_permissions.sh":
    mode: "000755"
    owner: root
    group: root
    content: |
      #!/bin/bash
      cd /var/app/current
      
      echo "Fixing file permissions..."
      chown -R webapp:webapp .next
      chown -R webapp:webapp node_modules
      chmod -R 755 .next
      echo "Permissions fixed"
